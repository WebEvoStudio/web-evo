(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8966],{40826:function(e,t,r){Promise.resolve().then(r.bind(r,57475))},96384:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});class s{static toParams(e){let t="";for(let r in e)e.hasOwnProperty(r)&&(t+="".concat(r,"=").concat(e[r],"&"));return t.substring(0,t.length-1)}static toFormData(e){let t=new FormData;for(let r in e)e.hasOwnProperty(r)&&t.append(r,e[r]);return t}}},4147:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var s=r(97684),n=r(96384);class a{request(e,t,r,n){let a={...this.config,url:e,method:t,data:r,headers:n},o=s.Z.create();return o.interceptors.response.use(this.responseInterceptor,this.errorInterceptor),o.request(a)}get(e,t){return this.request("".concat(e,"?").concat(n.Z.toParams(t)),"get")}post(e,t,r){return this.request(e,"post",t,r)}responseInterceptor(e){switch(e.status){case 200:case 201:return e.data;default:return console.log(e),Promise.reject(e)}}errorInterceptor(e){let t={message:"服务器错误",...e.response.data};return Promise.reject(t)}constructor(e){this.config={},this.config.baseURL="https://web-evo-server.bulv.life/",e&&(this.config.baseURL=e)}}},57475:function(e,t,r){"use strict";r.r(t),r.d(t,{Publish:function(){return k}});var s=r(32003),n=r(23426),a=r(79013),o=r(19773);r(70962);var i=r(64840),c=r(73520),l=r(86383),u=r(97060),h=r(97684),p=r(4147),d=r(96384),f=r(63722),v=r(65225),m=r(9770),g=r(79598),x=r(87270),Z=r(60948),b=r(69646);let w=()=>({editorEffect(e){e.editor.getInputField().addEventListener("onpaste",e=>{e.preventDefault()})}});var j=e=>{let[t,r]=(0,n.useState)(e.value||""),[a,j]=(0,n.useState)(e.title||""),k=[(0,c.Z)(),(0,l.Z)(),w()],y=!!e.id,{enqueueSnackbar:C}=(0,f.Ds)(),E=async e=>{let t=[];try{if(e.length>1)throw Error("一次只能上传一张图片");let r=e[0].name;if(-1!==r.indexOf(" "))throw Error("文件名不允许包含空格");let s=new p.Z("https://web-evo-server.bulv.life/"),n=await s.get("/ali/oss/policy",{}),{dir:a}=n,o=d.Z.toFormData({key:a.length?"".concat(a,"/").concat(e[0].name):e[0].name,...n,file:e[0]}),{filepath:i}=await s.post(n.host,o,{"Content-Type":"multipart/form-data"});return t.push({url:i,alt:"",title:""}),t}catch(e){throw C(e.message,{variant:"error"}),new DOMException(e.message)}};return(0,s.jsx)("div",{children:(0,s.jsx)("div",{className:"",children:(0,s.jsxs)(v.Z,{children:[(0,s.jsx)(m.Z,{title:(0,s.jsx)(g.Z,{sx:{flex:1},mr:2,children:(0,s.jsx)(x.Z,{label:"标题",size:"small",fullWidth:!0,value:a,onChange:e=>{let{target:{value:t}}=e;return j(t)}})}),action:(0,s.jsxs)(g.Z,{sx:{display:"flex",alignItems:"center",mt:"6px",mb:"4px"},children:[(0,s.jsx)(Z.Z,{variant:"outlined",sx:{mr:2},onClick:()=>{u.Z.write(JSON.stringify({title:a,mark_content:t})).then(()=>C("内容已复制到剪贴板",{variant:"success"}))},children:"复制到剪贴板"}),(0,s.jsx)(Z.Z,{variant:"outlined",onClick:y?()=>{let r="".concat("https://web-evo-server.bulv.life/").concat("blogs"),s={_id:e.id,title:a,markContent:t};h.Z.put(r,s).then(()=>C("文章修改成功",{variant:"success"})).catch(e=>C(e.message,{variant:"error"}))}:()=>{let e="".concat("https://web-evo-server.bulv.life/").concat("blogs");h.Z.post(e,{title:a,markContent:t}).then(()=>C("文章发布成功",{variant:"success"})).catch(e=>C(e.message,{variant:"error"}))},children:y?"保存修改":"发布"})]})}),(0,s.jsx)(b.Z,{children:(0,s.jsx)(o.M,{value:t,plugins:k,locale:i,onChange:e=>r(e),uploadImages:E})})]})})})};let k=()=>(0,s.jsx)(a.Z,{children:(0,s.jsx)(j,{})})}},function(e){e.O(0,[2204,7831,2344,1137,4300,7879,3722,8320,7270,7684,7912,3168,9065,8850,1744],function(){return e(e.s=40826)}),_N_E=e.O()}]);